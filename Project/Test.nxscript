
var xStep = 0;
var nbPoints = 50;

//Creation of the score
function onCreate() {
	//Viewport setup
	run("clear");
	run("add curve  auto");
	run("setPos current -2.5 0 0");
	xStep = map(1, 0, nbPoints, 0, 5);
	for(var i = 0 ; i < nbPoints ; i++) {
		var x = i*xStep;
		var y = sin(i);
		run("setPointAt current " + i + " " + x + " " + y + " 0");
	}
}

//If a message is received
function onMessage(protocol, host, port, destination, values) {
	//Message reception
	console("Received on '" + protocol + "' (" + host + ":" + port + ") to '" + destination + "', " + values.length + " values : ");
	for(var valueIndex = 0 ; valueIndex < values.length ; valueIndex++)
		console("- arg " + valueIndex + " = " + values[valueIndex]);

	//Parsing elements
	if((protocol == "midi") && (destination == "cc") && (values[1] == 1)) {
		var val = map(values[2], 0, 127, -1, 1);
		run("translatePoints lastCurve " + (-xStep) + " 0 0");
		run("removePointAt lastCurve 0");
		run("setPointAt lastCurve " + (nbPoints-1) + " " + 5 + " " + val + " 0");
	}
	else if((protocol == "osc") && (destination == "pts")) {
		var val = map(values[0], 0, 1, -1, 1);
		run("translatePoints lastCurve " + (-xStep) + " 0 0");
		run("removePointAt lastCurve 0");
		run("setPointAt lastCurve " + (nbPoints-1) + " " + 5 + " " + val + " 0");
	}
}
