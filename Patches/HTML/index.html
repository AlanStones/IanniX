<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
		<meta http-equiv="Content-Language" content="en" />
		<meta name="language" content="en" />
		<meta name="designer" content="buzzing light" />
		<meta name="description" content="IanniX documentation" />
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<link rel="apple-touch-startup-image"  href="index/img/iannix_apple_startup.png" />
		<link rel="apple-touch-icon" 		   href="index/img/iannix_apple.png" />
		<link rel="image_src" 				   href="index/img/iannix_facebook.jpg" />
		<link rel="shortcut icon" 			   href="index/img/favicon.ico" />
		<link rel="stylesheet" type="text/css" href="index/css/reset.css" />
		<link rel="stylesheet" type="text/css" href="index/css/style.css" />
		<script type="text/javascript" 		   src="index/js/jquery.js"></script>
		<script type="text/javascript" 		   src="index/js/JavaScript Library.js"></script>	
		<script type="text/javascript">
			var ipIanniX = "127.0.0.1:1236";
			var timeRefreshTransport = 100;
			var timeRefreshScreenshot = 80;

			$(document).ready(function() {
				//Periodic functions
				getTime();
				getScreenshot();

				//Interactions
				$("#play").click(function () {
					if($("#play").hasClass("checked"))	iannixQuery += "&run=stop";
					else								iannixQuery += "&run=play";
				});
				$("#ff").click(function () {
					$("#ff").addClass("checked");
					iannixQuery += "&run=fastrewind";
				});
				$("#reload").click(function () {
					$("#reload").addClass("checked");
					document.location.reload();
				});
				$("#screenshot").load(function() {
					$("#transport").css("top", $("#screenshot").height() + "px");
					$("#clock").css("top", $("#screenshot").height() + "px");
					$("#clock").css("left", ($("#screenshot").width()-$("#clock").width()-20) + "px");
					setTimeout(getScreenshot, timeRefreshScreenshot);
				});	
			});


			var iannixQuery = "";
			var playPos = 0;
			function getTime() {
				$.get("http://" + ipIanniX + "/?run=goto" + iannixQuery, function(data) {
					var dataValues = data.split("\n");

					//Timing
					if(dataValues.length > 0) {
						var playPosTemp = dataValues[0] * 1.;
						
						var min = Math.floor(playPos / 60);
						var sec = Math.floor(playPos) % 60;
						var ms  = Math.floor((playPos-(sec+min*60))*1000);
						var playPosStr = (min+"").pad(3) + ":" + (sec+"").pad(2) + "." + (ms+"").pad(3);
						$("#time").text(playPosStr);

						if(playPosTemp != playPos) {
							$("#play").addClass("checked");
							$("#play img").attr("src", "index/img/res_icon_pause.png");
						}
						else {
							$("#play").removeClass("checked");
							$("#ff").removeClass("checked");
							$("#play img").attr("src", "index/img/res_icon_play.png");
						}

						playPos = playPosTemp;
						setTimeout(getTime, timeRefreshTransport);
					}

					//Current time
					var clockObj = new Date();
					var clockStr = (clockObj.getHours()+"").pad(2) + ":" + (clockObj.getMinutes()+"").pad(2) + ":" + (clockObj.getSeconds()+"").pad(2);
					$("#clock").text(clockStr);
				});
				iannixQuery = "";
			}
			function getScreenshot() {
				$("#screenshot").attr("src", "http://" + ipIanniX + "?jpg=90&rnd=" + random(0, 100));
			}
		</script>
		<title>IanniX Web Remote</title>
	</head>

	<body>
		<div>
			<img src='' class='screenshot' id='screenshot'></img>
			<div class='transport' id='transport'>
				<div class='transportButton' id='ff'    > <img style='margin-top: 7px'  src='index/img/res_icon_ff.png' width='24px' height='24px'/>  </div>
				<div class='transportButton' id='play'  > <img style='margin-top: 10px' src='index/img/res_icon_play.png' width='18px' height='18px'/></div>
				<div class='transportTime'   id='time'>000:00.000</div>
				<div class='transportButton' id='reload'> <img style='margin-top: 7px'  src='index/img/res_icon_refresh.png' width='24px' height='24px'/>  </div>
			</div>

			<div class='clock' id='clock'>--:--:--</div>
		</div>
	</body>

</html>