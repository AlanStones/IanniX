<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
	<meta http-equiv="Content-Language" content="en" />
	<meta name="generator"   content="IanniX" />
	<meta name="language"    content="en" />
	<meta name="designer"    content="buzzing light" />
	<meta name="description" content="IanniX documentation" />
	<link href="../Common/css/reset.css"              rel="stylesheet" type="text/css" />
	<link href="../Common/font/stylesheet.css"        rel="stylesheet" type="text/css" />
	<link href="../Common/css/styleDocumentation.css" rel="stylesheet" type="text/css" />
	<script type="text/javascript" src="../Common/jquery.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {
			$("h3").next().hide();
			$("h3").click(function() {
				$(this).next().toggle(500);
			});
			
			var anchors = document.location.href.split("#");
			if(anchors.length > 1)
				$("#" + anchors[1] + " h3").next().toggle(500);
		});
	</script>
	<title>IanniX — Commands &amp; messages</title>
	<style type="text/css">
		li.c2 {list-style: none}
		a.c1 {color:#aaa; text-decoration:none;}
	</style>
</head>

<body>
	<div class='main container'>
		<table class="onglets" summary="">
			<tr>
				<td class="onglet" id='onglet_intro'><a href="intro.html">Introduction</a></td>
				<td class="onglet" id='onglet_objets'><a href="objets.html">Éléments<br/>principaux</a></td>
				<td class="onglet" id='onglet_script'><a href="script.html">Scripts</a></td>
				<td class="onglet" id='onglet_reference'><a href="reference.html">Référence</a></td>
			</tr>
		</table>
	<div class="langue">
		<a class="c1" href="../FR/index.html">Version française</a>
    </div>
	<script type="text/javascript">
		$(document).ready(function() {
			$("#onglet_script").addClass("actif");
		});
	</script>

    <h2>Principe</h2>

    <p>Avec IanniX, vous pouvez écrire vos propres scripts pour plus facilement créer des projets
    complexes. Les scripts sont écrits en Javascript mais même avec des connaissances limitées de
    Javascript, plusieurs types de scripts utiles peuvent être créés. En plus de cette
    documentation, plusieurs exemples de scripts sont fournis pour votre étude. Vous pouvez les
    trouver dans la section Scripts et Styles de l'inspecteur.</p>

    <p>Pour regarder un script, cliquez-droit sur un script dans l'explorateur et choisissez
    <code>Open</code>. Le menu de contexte contient aussi d'autres pour fonctionner avec les 
    scripts. De plus, vous pouvez exécuter un script en double-cliquant sur son nom dans
    l'inspecteur.</p>

    <p>Si vous voulez en apprendre plus sur le Javascript, pour créer des scripts plus avancés, il y a de nombreux
    livres, tutoriels en ligne and de référence disponibles pour vous aider. Aussi, n'hésitez pas
    à rechercher sur le forum de IanniX pour plus d'informations sur les conventions utilisées
    en écriture Javascript, ou pour des astuces pour écrire des scripts pour Iannix.</p>

    <p>Voici un lien vers la référence complète de la version de Javascript utilisée dans IanniX : <a href=
    "http://doc.qt.nokia.com/qsa-1.2.2/language.html">Référence</a></p>

    <h2>Contrôler IanniX à partir d'un script</h2>

    <h3>La commande Javascript <code>run()</code></h3><div>

    <p>La fonction run() est utilisée pour envoyer la plupart de commandes à IanniX à partir d'un script. Les commandes
    doivent être fournies à run() en tant que chaîne unique, les commandes de textes doivent donc être entre guillemets. 
	Exemple :</p>

    <p><code>run("zoom 100");</code> Définit le zoom à 100%</p>

    <p>Pour combiner des paramètres numériques avec des commandes de texte, afin de produire une chaîne à envoyer à
    <code>run()</code>, utilisez l'opérateur de concaténation. Dans l'exemple suivant, center_x
    et center_y sont des variables numériques et doivent être concaténées en chaîne.</p>

    <p><code>run("setPos current " + center_x + " " + center_y + " 0");</code></p>

    <p>Autres exemples :<br /></p>

    <ul>
      <li>Effacer la partition :<br />
      <code>run("clear");</code></li>

      <li>Définir le zoom à 100% :<br />
      <code>run("zoom 100");</code></li>

      <li>Donne au trigger un ID basé sur la valeur de la variable
      <code>myID</code> :<br />
      <code>run("add trigger " + myID);</code></li>

      <li>Définit le groupe d'un trigger à "foo" :<br />
      <code>run("setGroup current foo");</code></li>

      <li>Définit la position du trigger aux coordonnées x=1, y=3, z=0 :<br />
      <code>run("setPos current 1 3 0");</code></li>

      <li>Définit le message du trigger :<br />
      <code>run("setMessage current 1, osc://127.0.0.1:57120/trigger trigger_id
      trigger_xPos trigger_yPos cursor_id");</code></li>

      <li>Diminue de moitié la taille du trigger :<br />
      <code>run("setSize current 0.5");</code></li>
    </ul>

    <p>N'oubliez pas le «<code>;</code>» à la fin de chaque ligne. Notez que les constantes numériques
    ou les paramètres de type chaîne peuvent être inclus directement dans la commande de texte, tandis que les valeurs
    dans les variables doivent être jointes avec l'opérateur de concaténation. N'oubliez pas d'inclure
    des espaces dans les chaînes concaténées pour que les commandes et les paramètres dans la chaîne résultante soient 
	séparés d'au moins un espace.</p>

    <p>Voir <a href="listing.html">Index des fonctions</a> pour obtenir la liste des fonctions que vous
    pouvez utiliser dans la commande <code>run()</code> pour contrôler IanniX.</p>

    </div><h3>Les commandes <code>title()</code> et <code>ask()</code></h3><div>

    <p>En plus de <code>run()</code>, deux autres fonctions Javascript functions sont fournies pour
    écrire un script :</p>

    <ul>
      <li>Déclare "name" en tant que nom de votre projet :<br />
      <code>title("name");</code></li>

      <li>Ouvre une fenêtre où l'utilisateur peut remplir les constantes pour initialiser le
      script :<br />
      <code>ask("category, label, variable, defaultValue);</code><br />
      <br />
      Le paramètre «category» permet de regrouper plusieurs requêtes <code>ask()</code>
      sous un nom. Toutes les requêtes de la même catégorie sont regroupées sous
      le nom «category». «Label» est utilisé en tant qu'affichage de la requête. «Variable» est
      le nom d'une variable créée pour contenir les données. «Default» est la valeur
      suggérée à l'utilisateur en tant que valeur par défaut de la variable. L'utilisateur est libre de
      nommer les catégories, labels et les variables tels que requis.<br /></li>
    </ul>

    </div><h3>La structure d'un script</h3><div>

    <p>IanniX exécute un script en plusieurs phases. Vous pouvez contrôler la phase dans laquelle
    vos commandes sont utilisées en les regroupant dans des fonctions appelées lors de
    phases spécifiques de l'exécution. Ces fonctions sont :</p>

    <ul>
      <li>Appelé par IanniX pour préparer un script à être exécuté :<br />
      <code>onCreate()</code><br />
      {<br />
      //Insérer vos commandes ici<br />
      };</li>

      <li>Appelé par IanniX pour mener à bien les actions prévues par le script :<br />
      <code>onConfigure()<br />
      {<br />
      //Insérer vos commandes ici<br />
      };</code></li>

      <li>Appelé à chaque fois que IanniX reçoit un message OSC. Cette section est seulement nécessaire
      pour les scripts qui reçoivent des messages OSC. (Par exemple pour le script
      de configuration) :<br />
      <code>onMessage()<br />
      {<br />
      //Insérer vos commandes ici<br />
      };</code></li>
    </ul>

    <p>Voici l'exemple d'un script simple :</p><br />
    <pre>
          //Configuration du script
          function onConfigure() {                
              title("My new script");             //Nomme le script
              
              //Demande les paramètres pour personnaliser le comportement du script
              iannix.ask("Triggers", "Trigger x-position", "trigger_xPosition", 3);
          }
          
          //Création de la partition
          function onCreate() {
              run("clear");                       //Efface les objets de la partition
              run("center 0 0");                  //Se centre sur l'origine de la partition
              run("zoom 100");                    //100% zoom
  
              run("add trigger 1");               //Ajoute un trigger d'ID 1
              run("setPos current 1 2 0");        //Déplace le trigger aux coordonnées (1, 2, 0)
  
              addATrigger();                      //Appelle votre fonction personnalisée
          }
          
          //Définit une fonction personnalisée
          function addATrigger() {
              //Insérer le code pour ajouter et configurer un trigger ici.
              //Normalement la fonction addATrigger() doit avoir des paramètres à passer pour ajouter le trigger.
          }
                
</pre>

    <p>Les deux seules fonctions qui doivent être dans la fonction <code>configure()</code> sont
    <code>title() et <code>ask()</code>. Le reste du code à exécuter doit
    être placé dans la fonction <code>create()</code>. Vous pouvez aussi définir vos propres
    fonctions, constantes, etc. en plus des fonctions principales. Comme par exemple,
    la fonction <code>addATrigger()</code>, ci-dessus.</code></p>

    </div><h3>Créer vos propres fonctions</h3><div>

    <p>Exemple : Cette fonction donne un nombre aléatoire entre les paramètres
    <code>min</code> et <code>max</code>.</p>

    <p><code>function randomFloat(min, max) {<br />
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return Math.random() * (max-min) + min;<br />
    }</code></p>

    </div><h3>Créer vos propres bibliothèques de fonctions</h3><div>

    <p>Iannix donne la possibilité de prédéfinir des bibliothèques de fonctions fréquemment utilisées
    dans les scripts. Les fichiers de type <code>&lt;name&gt;.js</code> dans le dossier Outils
    sont scannés au démarrage de IanniX et les variables, classes et fonctions
    sont rendues disponibles pour leur utilisation dans les scripts. Notez que si une bibliothèque de fichier est
    éditée lorsque IanniX est lancé, IanniX doit être redémarré pour que les modifications prennent
    effet.</p>

    <div id="drawingcurves" class='main container'></div>

    </div><h2>Dessiner des courbes de Bézier</h2>

    <p>La fonction setPointAt() de IanniX permet aux scripts de créer des courbes en 2D et en 3D à partir
    d'une séquence de lignes droites et de segments courbés (Bézier cubique).</p>

    <h3>Créer une courbe</h3><div>

    <p>Commencez une nouvelle courbe avec :<br />
    <code>run("add curve id");</code><br />
    Créer un objet courbe avec l'ID spécifié. La courbe n'a encore reçu aucun
    points. La localisation d'un nouvel objet est par défaut (0,0,0).</p>

    </div><h3>La fonction setPointAt</h3><div>

    <p>La fonction setPointAt est utilisée pour ajouter des points ou changer des points sur une courbe.
    Le comportement de la fonction setPointAt() diffère selon les paramètres reçus :<br /></p>

    <ul>
      <li>Pour définir le premier point de la trajectoire :<br />
      <code>run("setPointAt id 0 x y &lt;z&gt;");<br />
      définit le point 0 à x, y (et facultativement z pour une trajectoire 3D).</code></li>

      <li>Pour ajouter un segment de ligne droite à la trajectoire :<br />
      <code>run("setPointAt id pNum x y &lt;z&gt;");</code><br />
      où pNum est le nombre du point précédant toujours le point de nombre pNum+1.</li>

      <li>Pour changer le point final d'un segment de ligne droite d'une trajectoire existante :<br />
      <code>run("setPointAt id pNum x y &lt;z&gt;");</code><br />
      où pNum est le nombre du point à changer.</li>

      <li>Pour ajouter un segment courbé et définir sa courbure :<br />
      <code>run("setPointAt id pNum x y &lt;z&gt; dxStart dyStart &lt;dzStart&gt; dxEnd
      dyEnd &lt;dzEnd&gt; ");</code><br />
      où le point final du segment est x, y et facultativement z. Le segment démarre
      tangent à une ligne depuis son point de départ, (la fin du segment précédent) jusqu'au
      point <code>(xStart+dxStart, yStart+dyStart, &lt;zStart+dZstart&gt;)</code>. Le
      segment finit tangent à une ligne de son point final <code>(x, y, &lt;z&gt;)</code> au
      point <code>(x+dxEnd, y+dyEnd, &lt;z+dyEnd&gt;)</code>. Notez que le point
      de départ sera le point <code>(x, y, &lt;z&gt;)</code> dans l'appel précédent de
      setPointAt.</li>

      <li>Pour changer un segment courbé précédemment défini :<br />
        <code>run("setPointAt id pNum cx1 cy1 &lt;cz1&gt; cx2 cy2 &lt;cz2&gt; x y
        &lt;z&gt;");</code><br />
        où pNum est le nombre d'un point précédemment définir et les autres paramètres
        comme définis ci-dessus.<br />

        <p>(Les paramètres optionnels sont indiqués entre parenthèses &lt; &gt;)</p>
      </li>
    </ul>

    <p>Tous les champs de <code>setPointAt</code> spécifient la localisation du point comme x y
    &lt;z&gt;. Les paramètres qui spécifient les segments de Bézier incluent deux autres points, cx1 cy1
    &lt;cz1&gt; et cx2 cy2 &lt;cz2&gt;, qui décrivent la courbure. La direction de
    la courbe quittant son point de départ est tangente à la ligne à partir du point de départ jusqu'au
    premier point de contrôle cx1 cy1 &lt;cz1&gt;. La direction de la courbe arrivant à son point final
    est tangente à la ligne à partir du point de contrôle cx2 cy2 &lt;cz2&gt; jusqu'au point final
    x y &lt;z&gt;.</p>

    </div><h3>Exemple d'une création de courbe avec des segments 2D et 3D</h3><div>

    <p>Le code suivant est celui de l'exemple "Learn - Curve points" qui peut être trouvé
    dans l'explorateur de scripts de l'inspecteur. Il créé une trajectoire avec cinq segments et
    cinq points. Le premier segment est une ligne droite en 2D, la seconde est une courbe de Bézier 2D, la suivante est
    une ligne droite en 3D et le quatrième segment est une Bézier 3D. Lancez le script d'exemple pour
    voir à quoi ressemble la courbe. Pour voir sa forme en 3D, pressez la touche Alt et glissez
    la souris sur la partition. Vous pouvez réinitialiser l'angle de vue en lançant le script "Reset
    orientation" dans la section Outils du navigateur de scripts.</p>
    <pre>
   
          //Création de la partition
          function onCreate() {
              //Configuration de la vue
              run("clear");
              run("center 0 0");
              run("zoom 100");
              run("rotate 0 0 0");
                  
              //Création de la courbe
              run("add curve  1000");
          
              //Point numéro 0
              //Coordonnées x0 = -2, y0 = 1
              run("setPointAt current  0  -2 1");
          
              //Dessine un segment droit en 2D du point numéro 0 au
              //point numéro 1, qui est à (x1,y1) = (-2,3)
              run("setPointAt current  1   -2  3");
          
              //Dessine un segment de Bézier en 2D du point numéro 1 au
              //point numéro 2, qui est à (x2,y2) = (2,3)
              //Le segment de départ est tangent à la ligne de (x1,y1) à (x1+2, y1+2)
              //Le segment de fin est tangent à la ligne de (x2,y2) à (x2+0,x2+3)
              run("setPointAt current  2    2  3   +2 +2   +0 +3 ");
          
              //Dessine un segment droit en 3D du point numéro 2 au
              //point numéro 3, qui est à (x3,y3,z3) = (0,2,1)
              run("setPointAt current  3    0 2 1");
          
              //Dessine un segment de Bézier en 3D du point numéro 3 au
              //point numéro 4, qui est à (x4,y4,z4) = (-2,-1,0) 
              //Il commence tangent à la ligne de (x3,y3,z3) à (x3+0,y3-1,z3+2)
              //Finit tangent à la ligne de (x4,y4,z4) à (x4+4,x4+0,z4+0)
              run("setPointAt current  4   -2 -1 0   +0 -1 +2   +4 +0 +0");
          
              //Rajoute un curseur sur la courbe
              run("add cursor 1");
              run("setCurve   current lastCurve");        
              run("setSpeed   current auto 10");
          }
        
</pre>
  </div>
</body>
</html>
	</div>
</body>
</html>